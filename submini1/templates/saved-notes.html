<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Saved Notes</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #5e5e5e;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #f4ac3e;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 4px solid #c88c26;
    }

    .container {
      max-width: 800px;
      margin: 2rem auto;
      background: white;
      border-radius: 10px;
      padding: 2rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .note {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: #fffbe6;
    }

    .note h3 {
      margin-top: 0;
      color: #2c3e50;
    }

    .note p {
      color: #555;
    }

    .note time {
      font-size: 0.9rem;
      color: #888;
      display: block;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>

  <header>Saved Notes</header>
  <a href="{% url 'index' %}">
  <button style="margin: 10px; padding: 0.5% 1%; font-size: 16px; background-color: #f4ab3e; color: black; border:#3b351079; border-radius: 10%; cursor:pointer
  ;">
    ‚¨Ö Back to Home
  </button>
</a>

  <div class="container">
    {% if saved_notes %}
    {% for note in saved_notes %}
  <div class="note" id="note-{{ note.id }}">
    <h3 id="title-{{ note.id }}">{{ note.title }}</h3>
    <p id="content-{{ note.id }}">{{ note.content }}</p>
    <time>Saved on: {{ note.created_at|date:"F j, Y, g:i a" }}</time>

    <button type="button"
            onclick="enableEdit('{{ note.id }}')"
            style="margin-top:10px; background:#3498db; color:white; border:none; padding:6px 10px; border-radius:5px; cursor:pointer;">
      ‚úèÔ∏è Edit
    </button>

    <button type="button"
            onclick="deleteNote('{{ note.id }}')"
            style="margin-top:10px; background:#e74c3c; color:white; border:none; padding:6px 10px; border-radius:5px; cursor:pointer;">
      üóë Delete
    </button>
  </div>
{% endfor %}
{% else %}
<p>No saved notes yet.</p>
{% endif %}
</div>

  
  
<script>
  /* ---------- CSRF ---------- */
function getCSRFToken() {
    let name = 'csrftoken';
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        document.cookie.split(';').forEach(cookie => {
            cookie = cookie.trim();
            if (cookie.startsWith(name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            }
        });
    }
    return cookieValue;
}
/* ---------- DELETE ---------- */
function deleteNote(noteId) {
    if (!confirm("Are you sure you want to delete this note?")) return;

    fetch(`/delete_note/${noteId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCSRFToken()
        }
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'success') {
            document.getElementById(`note-${noteId}`).remove();
        } else {
            alert("Failed to delete note");
        }
    })
    .catch(err => {
        console.error(err);
        alert("Server error");
    });}
  /* ---------- EDIT ---------- */
function enableEdit(noteId) {
  const titleEl = document.getElementById(`title-${noteId}`);
  const contentEl = document.getElementById(`content-${noteId}`);

  const oldTitle = titleEl.innerText;
  const oldContent = contentEl.innerText;

  titleEl.innerHTML = `<input id="edit-title-${noteId}" value="${oldTitle}" style="width:100%">`;
  contentEl.innerHTML = `<textarea id="edit-content-${noteId}" style="width:100%">${oldContent}</textarea>`;

  const noteDiv = document.getElementById(`note-${noteId}`);
  noteDiv.innerHTML += `
    <button style="background:#2ecc71; color:white;"
            onclick="saveEdit('${noteId}')">üíæ Save</button>
    <button style="background:#95a5a6; color:white;"
            onclick="location.reload()">‚úñ Cancel</button>
  `;
}

function saveEdit(noteId) {
  const title = document.getElementById(`edit-title-${noteId}`).value;
  const content = document.getElementById(`edit-content-${noteId}`).value;

  fetch(`/edit_note/${noteId}/`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCSRFToken()
    },
    body: JSON.stringify({ title, content })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === 'success') {
      location.reload();
    } else {
      alert("Edit failed");
    }
  });
}
</script>


</body>
</html>
